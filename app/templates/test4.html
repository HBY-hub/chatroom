
<!DOCTYPE HTML>
<html>
<head>
    <title>Flask-SocketIO Test</title>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            namespace= '/chat';
            console.log(location.protocol)
            console.log(document.domain)
            console.log(location.port)
            //var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);//连接
            var socket = io.connect("http://118.126.104.223/chat");
            socket.on('connect', function() {     //打开页面时
                socket.emit('connection', {         //发送一次emit
                    username:"nameName",        //当前用户的用户名
                    roomid:1                    //当前房间id
                });
            });
            // socket.on('disconnect', function() {
            //     // socket.emit('connect', {data: 'I\'m connected!'});
            //     socket.emit('disconnection', {
            //         username:"nameName",
            //         roomid:1
            //     });
            // });
            socket.on("new_user",function (msg) {  //有新人加入收到，加入者也会收到
                //  例如
                // {
                //     username: "nameName",
                //     num: 1,
                //     roomid: 1
                // }
                console.log(msg)
            })
            socket.on('response', function(msg) {   //有人发消息，发送者也会收到
                //  例如
                // {
                //      content: "CONTENT",
                //      roomid: 1,
                //      sender: "userUser"
                // }
                console.log(msg)
            });
            socket.on("leave_user",function (msg) { //有人退出，退出者也会收到
                //  例如
                // {
                //      username: "LEAVE",
                //      num: 0,
                //      roomid: 1
                // }
                console.log(msg)
            })


            var btn = document.getElementById("btn");
            //手动退出，不会写关闭页面事件
            btn.onclick=function(){

                socket.emit("disconnection",{
                    username:"LEAVE",
                    roomid:1
                })

            }


            var btnn = document.getElementById("btnn");

            //点击任何一个input标签的button都将执行，本测试只有一个
                btnn.onclick=function(){

                    //获取指定id的第一个元素内容
                    alert("1");
                    var name = $("#userName").val();
                    //执行ajax
                    $.ajax({
                        //传输类型，这里使用Post
                        type: "POST",
                        //传输地址，这里是间接路径，测试路径在同目录下
                        url: "http://118.126.104.223/admin/user",
                        //url: "/admin/user_login",
                        //传输数据,也可以通过问号传值, 比如  url："search?name="+name
                        data:{"name": "hby","pwd":"hby"},
                        //成功执行时
                        success: function (mess) {
                            //消息反馈为 "yes"
                            console.log(mess);
                        }
                    })
                }



            $('form#emit').submit(function(event) {   //发送 消息
                console.log("okokokok")
                console.log(location.protocol + '//' + document.domain + ':' + location.port + namespace)
                socket.emit('my_event', {
                    username:"userUser",
                    userid:"userId",
                    roomid:1,
                    content:"CONTENT"

                });
                // socket.emit('my_event', {data: $('#emit_data').val()});
                return false;
            });
        });
    </script>
</head>
<body>
    <h1>Flask-SocketIO Test</h1>
    <p>Async mode is: <b>{{ async_mode }}</b></p>
    <h2>Send:</h2>
    <form id="emit" method="POST" action='#'>
        <input type="text" name="emit_data" id="emit_data" placeholder="Message">
        <input type="submit" value="Echo">
    </form>
    <h2>Receive:</h2>
    <div id="log"></div>
    <button id="btn" style="height: 100px;width: 100px">BYE</button>
    <br>
<button  type="button" id="btnn" style="height: 100px;width: 100px" value="跨域"/>

</body>
</html>